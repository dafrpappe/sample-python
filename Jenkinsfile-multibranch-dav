
pipeline {
  agent { 
    dockerfile {
      args '-u root'
    } 
  }
  parameters {

  }
  stages {
      stage('Test code') {

          when {
            branch 'feat.*'

          }
          steps {
              sh """
              echo "Test code"
              """            
              cleanWs()

              git branch: '${ghprbSourceBranch}',
                  credentialsId: 'dafrpappe',
                  url: 'https://github.com/dafrpappe/sample-python'
              checkout([$class: 'GitSCM', branches: [[name: env.ghprbActualCommit]]])


              sh './hello_world.py'
        }
      }      
      stage('Main Branch Deploy Code') {
          when {
              branch 'main'
          }
          steps {


              sh """
              echo "Building Artifact from Master branch"
              """

              sh """
              echo "Deploying Code from Main branch"
              """
        }
    }
    stage('Stage Branch Deploy Code') {
        when {
            branch 'stage'
        }
        steps {
            sh """
            echo "Building Artifact from Stage branch"
            """
            sh """
            echo "Deploying Code from Stage branch"
            """
            sh """
            echo "Created a test branch"
            """
       }
    }
  }
}
