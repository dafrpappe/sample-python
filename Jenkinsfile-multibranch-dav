
pipeline {
  agent { 
    dockerfile {
      args '-u root'
    } 
  }
  stages {
     stage('Setup parameters') {
         steps {
            script { 
                properties([
                    parameters([
                        string(
                            defaultValue: '', 
                            name: 'ghprbActualCommit', 
                            trim: true
                        )
                    ])
                ])      
            }
         }
      }      
      stage('Test code') {

          when {
            branch 'feat.*'

          }
          steps {
              sh """
              echo "Test code"
              """            
              cleanWs()

              git branch: '${ghprbSourceBranch}',
                  credentialsId: 'dafrpappe',
                  url: 'git@github.com:dafrpappe/sample-python.git'
              checkout([$class: 'GitSCM', branches: [[name: params.ghprbActualCommit]]])


              sh './hello_world.py'
        }
      }      
      stage('Main Branch Deploy Code') {
          when {
              branch 'main'
          }
          steps {


              sh """
              echo "Building Artifact from Master branch"
              """

              sh """
              echo "Deploying Code from Main branch"
              """
        }
    }
    stage('Stage Branch Deploy Code') {
        when {
            branch 'stage'
        }
        steps {
            sh """
            echo "Building Artifact from Stage branch"
            """
            sh """
            echo "Deploying Code from Stage branch"
            """
            sh """
            echo "Created a test branch"
            """
       }
    }
  }
}
