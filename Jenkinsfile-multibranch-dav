
pipeline {
  agent { 
    dockerfile {
      args '-u root'
    } 
  }
  stages {
     stage('Setup parameters') {
         steps {
            script { 
                properties([
                    parameters([
                        string(
                            defaultValue: '', 
                            name: 'ghprbActualCommit', 
                            trim: true
                        )
                    ])
                ])      
            }
         }
      }      
      stage('Test code') {

          when {
            branch 'feat.*'

          }
          steps {
              sh """
              echo "Test pull request number # ${env.CHANGE_ID}"
              """            
              

              sh 'chmod +x  hello_world.py ; ./hello_world.py'
        }
      }      
      stage('Main Branch Deploy Code') {
          when {
              branch 'main'
          }
          steps {


              sh """
              echo "Building Artifact from Master branch"
              """

              sh """
              echo "Deploying Code from Main branch"
              """
        }
    }
    stage('Stage Branch Deploy Code') {
        when {
            branch 'stage'
        }
        steps {
            sh """
            echo "Building Artifact from Stage branch"
            """
            sh """
            echo "Deploying Code from Stage branch"
            """
            sh """
            echo "Created a test branch"
            """
       }
    }
  }
  post { 
      always { 
          echo 'I will always say Hello again!'
      }
  }  
}
