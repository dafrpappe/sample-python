pipeline {
  agent { 
    dockerfile {
      args '-u root'
    } 
  } 
  stages {    
    stage('Publish on github'){

        steps{
            sh '''
               echo "${PASSWORD}"

               '''


        }
    }
    stage('Build artifact'){

      steps {
        script {

        sh '''

           echo "Publishing on Github...===="           

           git config --global --add safe.directory /home/admin/workspace/python-jenkinsfile  

          '''
           GIT_TAG = sh(returnStdout: true, script: 'git describe --tags') return GIT_TAG
           GIT_MAME = sh(returnStdout: true, script: 'echo "test release"') return GIT_MESSAGE
           GIT_DESCRIPTION = sh(returnStdout: true, script: 'echo "this is a test 67"') return GIT_MESSAGE

           GIT_JSON= sh(returnStdout: true, script: 'echo "this is a test 67"') return GIT_MESSAGE
 
           echo "$GIT_TAG"
           
           def jsonString = '{ \"tag_name\" : \"$GIT_TAG\" , \"target_commitish\" : \"main\" , \"name\" : \"$name\" , \"body\" : \"$description\" , \"draft\" : false, \"prerelease\" : true }'
           def jsonObj = readJSON text: jsonString

           sh "echo ${jsonObj.tag_name}"

         '''  
           # Get the full message associated with this tag                    


           echo "DONE"
           



        '''          

        }
      }    
    }
    stage('Build') {
      steps {
        // Clean before build
        sh '''
           echo "Building artifact ....."

        '''

      }
    }    
  }
}